!function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(1),c=r(9),f=n(c),l=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return["recalc","onDrop","onDragStart","onSnapEnd","resetPosition"].forEach(function(t){return e[t]=e[t].bind(e)}),e.controller.subscribe("recalc",e.recalc),e.game=new f.default,e.plannedMove=document.getElementsByClassName("detail--planned")[0],e.resetButton=document.getElementsByClassName("detail--reset")[0],e.board=new ChessBoard("detail--board",{draggable:!0,dropOffBoard:"trash",onDragStart:e.onDragStart,onDrop:e.onDrop,onSnapEnd:e.onSnapEnd}),e.resetButton.onclick=e.resetPosition,e}return u(t,e),s(t,[{key:"presentView",value:function(e){this.updateView(e.data)}},{key:"recalc",value:function(e){this.updateView(e)}},{key:"updateView",value:function(e){e&&(this.startPosition=e,this.resetPosition())}},{key:"resetPosition",value:function(){this.game.load(this.startPosition),this.board.position(this.startPosition),this.plannedMove.innerText=""}},{key:"onDragStart",value:function(e,t){return!this.game.game_over()&&t.indexOf(this.game.turn())>-1}},{key:"onDrop",value:function(e,t){var r=this.game.move({from:e,to:t,promotion:"q"});return null===r?"snapback":void(this.plannedMove.innerText=""===this.plannedMove.innerText?"[ "+r.san+" ]":this.plannedMove.innerText)}},{key:"onSnapEnd",value:function(){this.board.position(this.game.fen())}}]),t}(a.SiftView);t.default=l,(0,a.registerSiftView)(new l(window))},function(e,t,r){var n,o;(function(e,i){!function(e,r){r(t)}(this,function(t){function u(e,t){return t={exports:{}},e(t,t.exports),t.exports}function s(e){Y.trace("[opCreateDb]: ",e);var t={};switch(e.type){case"MSG":t.msg=Z("rs_msg_db-"+e.accountGuid,v(ee));break;case"SIFT":if(!e.siftGuid)throw new Error("[opCreateDb]: dbInfo.siftGuid undefined");Y.trace("[opCreateDb]: creating SIFT db");var r=y(e.schema,!0);r=r.addStore("_user.default").addStore("_redsift"),t.db=Z(e.siftGuid+"-"+e.accountGuid,r),t.msg=Z("rs_msg_db-"+e.accountGuid,v(ee));break;case"SYNC":Y.trace("[opCreateDb]: creating SYNC db"),t.db=Z("rs_sync_log-"+e.accountGuid,y(te));break;case"CLIENT":t.db=Z("rs_client_db-"+e.clientName,y(re));break;default:throw new Error("[opCreateDb]: unsupported db type: "+e.type)}return t}function a(e,t,r){if(Y.trace("[opDel]: ",t,r),!t.bucket)return Promise.reject("[opDel]: params.bucket undefined");if(!t.keys||0===t.keys.length)return Y.trace("[opDel]: params.keys undefined"),Promise.resolve();if(X.indexOf(t.bucket)!==-1){var n=t.keys.map(function(e){return r+"/"+e});return m(e.msg,{bucket:t.bucket,keys:n})}return m(e.db,t)}function c(e,t,r){if(Y.trace("[opGet]: ",t),!t.bucket)return Promise.reject("[opGet]: params.bucket undefined");if(!t.keys||0===t.keys.length)return Promise.reject("[opGet]: param.keys undefined");if(X.indexOf(t.bucket)!==-1){var n=t.keys.map(function(e){return r+"/"+e});return w(e.msg,{bucket:t.bucket,keys:n}).then(function(e){return e.map(function(e){return{key:e.key.split("/")[1],value:e.value}})})}return w(e.db,t)}function f(e,t,r){return Y.trace("[opGetAll]: ",t,r),t.bucket?X.indexOf(t.bucket)!==-1?k(e.msg,{bucket:t.bucket,index:"sift.guid",range:r},!0).then(function(e){return e.map(function(e){return{key:e.key.split("/")[1],value:e.value}})}):k(e.db,t,!0):Promise.reject("[opGetAll]: params.bucket undefined")}function l(e,t,r){return Y.trace("[opGetAllKeys]: ",t,r),t.bucket?X.indexOf(t.bucket)!==-1?k(e.msg,{bucket:t.bucket,index:"sift.guid",range:r},!1).then(function(e){return e.map(function(e){return e.key.split("/")[1]})}):k(e.db,t,!1):Promise.reject("[opGetAllKeys]: params.bucket undefined")}function p(e,t,r){return Y.trace("[opGetIndex]: ",t,r),t.bucket?X.indexOf(t.bucket)!==-1?k(e.msg,{bucket:t.bucket,index:"sift.guid",range:r},!0).then(function(e){return e.map(function(e){return{key:e.key.split("/")[1],value:e.value}})}):t.index?k(e.db,t,!0):Promise.reject("[opGetIndex]:params.index undefined"):Promise.reject("[opGetIndex]:params.bucket undefined")}function d(e,t,r){return Y.trace("[opGetIndexKeys]: ",t,r),t.bucket?X.indexOf(t.bucket)!==-1?k(e.msg,{bucket:t.bucket,index:"sift.guid",range:r},!1).then(function(e){return e.map(function(e){return{key:e.key.split("/")[1],value:e.value}})}):t.index?k(e.db,t,!1):Promise.reject("[opGetIndexKeys]: params.index undefined"):Promise.reject("[opGetIndexKeys]: params.bucket undefined")}function h(e,t,r){if(Y.trace("[opGetWithIndex]: ",t,r),!t.bucket)return Promise.reject("[opGetWithIndex]:params.bucket undefined");if(!t.keys)return Promise.reject("[opGetWithIndex]:params.keys undefined");if(X.indexOf(t.bucket)!==-1){var n=t.keys.map(function(e){return r+"/"+e});return _(e.msg,{bucket:t.bucket,keys:n,index:"sift.guid",range:r}).then(function(e){return e.map(function(e){return{key:e.key.split("/")[1],value:e.value}})})}return t.index?t.range?_(e.db,t):Promise.reject("[opGetWithIndex]:params.range undefined"):Promise.reject("[opGetWithIndex]:params.index undefined")}function g(e,t,r,n){Y.trace("[opPut]: ",t,r,n);var o=e.db;if(!t.bucket)return Promise.reject("[opPut]: params.bucket undefined");if(!t.kvs||0===t.kvs.length)return Y.warn("[opPut]: params.kvs undefined"),Promise.resolve();var i=t.kvs;if(r||(i=i.map(function(e){return{key:e.key,value:{value:e.value}}})),X.indexOf(t.bucket)!==-1){o=e.msg;var i=i.map(function(e){return{key:n+"/"+e.key,value:e.value}})}return b(o,{bucket:t.bucket,kvs:i},r)}function y(e,t){Y.trace("[_getTreoSchema]: ",e,t);var r=Z.schema().version(1);return e.forEach(function(e){t&&X.indexOf(e.name)!==-1||(r=e.keypath?r.addStore(e.name,{key:e.keypath}):r.addStore(e.name),e.indexes&&e.indexes.forEach(function(e){r=r.addIndex(e,e,{unique:!1})}))}),r}function v(e,t){Y.trace("[_getVersionedTreoSchema]: ",e,t);var r=Z.schema();return e.forEach(function(e,n){r=r.version(n+1),e.forEach(function(e){t&&X.indexOf(e.name)!==-1||(e.drop?(Y.trace("[_getVersionedTreoSchema]: dropping store: ",e.name),r=r.dropStore(e.name)):r=e.keypath?r.addStore(e.name,{key:e.keypath}):r.addStore(e.name),e.indexes&&e.indexes.forEach(function(t){e.drop?(Y.trace("[_getVersionedTreoSchema]: dropping store/index: "+e.name+"/"+t),r=r.dropIndex(t)):r=r.addIndex(t,t,{unique:!1})}))})}),r}function m(e,t){return Y.trace("[_batchDelete]: ",t),new Promise(function(r,n){e.transaction("readwrite",[t.bucket],function(e,o){if(e)return n(e);var i=o.objectStore(t.bucket),u=0,s=function(){if(!(u>=t.keys.length)){var e,r=t.keys[u];e=i.delete(r),e.onerror=n,e.onsuccess=s,u+=1}};o.onerror=o.onabort=n,o.oncomplete=function(){r()},s()})})}function b(e,t){return Y.trace("[_batchPut]: ",t),new Promise(function(r,n){var o=t.kvs.length;e.transaction("readwrite",[t.bucket],function(e,i){if(e)return n(e);var u=i.objectStore(t.bucket),s=0,a=function(){if(!(s>=o)){Y.trace("[_batchPut: put: ",t.kvs[s]);var e;e=u.put(t.kvs[s].value,t.kvs[s].key),e.onerror=n,e.onsuccess=a,s+=1}};i.onerror=i.onabort=n,i.oncomplete=function(){r()},a()})})}function _(e,t){return Y.trace("[_getWithIndexRange]: ",t),new Promise(function(r,n){var o=e.store(t.bucket),i=[],u=0,s=function(e){var r=t.keys.indexOf(e.primaryKey);return r!==-1&&(Y.trace("[found key: ",e.primaryKey),i[r].value=e.value.value,u++),u===t.keys.length?a():void e.continue()},a=function(e){Y.trace("[_getWithIndexRange: result: ",i),e?n(e):r(i)};t.keys.forEach(function(e){i.push({key:e,value:void 0})}),o.cursor({index:t.index,range:t.range,iterator:s},a)})}function w(e,t){return Y.trace("[_findIn]: ",t),new Promise(function(r,n){var o=e.store(t.bucket),i=[],u=0,s=function(e){if(Y.trace("[_findIn]: iterator: ",e),e.key>c[u]){for(Y.trace("[_findIn]: cursor ahead: ",e.key,c[u]);e.key>c[u]&&u<c.length;)u+=1,Y.trace("[_findIn]: moving to next key: ",e.key,c[u]);if(u>c.length)return Y.trace("[_findIn]: exhausted keys. done."),a()}e.key===c[u]?(Y.trace("[_findIn]: found key: ",e.key,e.value),i[t.keys.indexOf(c[u])]={key:e.key,value:e.value.value},u+=1,u<c.length?e.continue(c[u]):a()):(Y.trace("[_findIn]: continuing to next key: ",c[u]),e.continue(c[u]))},a=function(e){Y.trace("[findIn]: result: ",i),e?n(e):r(i)},c=t.keys.slice();c=c.sort(Z.cmp),Y.trace("[findIn: sorted keys: ",c),t.keys.forEach(function(e){i.push({key:e,value:void 0})}),o.cursor({iterator:s},a)})}function k(e,t,r){return Y.trace("[_getAll]: ",t,r),new Promise(function(n,o){var i=[],u=[],s=e.store(t.bucket),a=function(e){var n={key:e.primaryKey};Y.trace("[_getAll]: cursor",e),r&&(n.value=e.value.value),t.index&&(n.index=e.key),i.push(n),u.push(e.primaryKey),e.continue()},c={iterator:a};t.index&&(c.index=t.index),t.range&&(c.range=t.range),s.cursor(c,function(e){e?o(e):t.index||t.range||r?(Y.trace("[_getAll]: resolving: ",i),n(i)):(Y.trace("[_getAll]: resolving: ",u),n(u))})})}function E(t){e.log("[Redsift::registerSiftView]: registered")}function x(e){return j(P,e)}function S(e){return j(ue,e)}function I(t){e.log("[Redsift::registerSiftController]: registered")}function O(e){return j(A,e)}function T(t){e.log("[Redsift::registerEmailClientController]: registered")}function j(e,t){var r=function(){e.call(this),this.init&&"function"==typeof this.init&&this.init()};return r.prototype=Object.create(e.prototype),r.constructor=r,Object.keys(t).forEach(function(e){r.prototype[e]=t[e]}),new r}var A=function(){this._proxy=self,this._registerMessageListeners()};A.prototype._registerMessageListeners=function(){var e=this;this._proxy&&(this._proxy.onmessage=function(t){var r=t.data.method;e["_"+r]&&e["_"+r](t.data.params)})},A.prototype._emailStats=function(e){this.onstats&&this.onstats(e.name,e.value)},A.prototype._getThreadRowDisplayInfo=function(e){var t=this,r={};e.tris.forEach(function(n){void 0!==n.value&&void 0!==n.value.list&&t.loadThreadListView&&(r[n.key]=t.loadThreadListView(n.value.list,e.supportedTemplates))}),this._proxy.postMessage({method:"getThreadRowDisplayInfoCallback",params:r})};var C=function(){this._observers=[]};C.prototype.subscribe=function(e,t){this._op("_sub",e,t)},C.prototype.unsubscribe=function(e,t){this._op("_unsub",e,t)},C.prototype.unsubscribeAll=function(e){this._observers[e]&&delete this._observers[e]},C.prototype.publish=function(e,t){this._op("_pub",e,t)},C.prototype._op=function(e,t,r){var n=this;Array.isArray(t)?t.forEach(function(t){n[e](t,r)}):this[e](t,r)},C.prototype._sub=function(e,t){this._observers[e]||(this._observers[e]=[]),t&&this._observers[e].indexOf(t)===-1&&this._observers[e].push(t)},C.prototype._unsub=function(e,t){if(this._observers[e]){var r=this._observers[e].indexOf(t);~r&&this._observers[e].splice(r,1)}},C.prototype._pub=function(e,t){var r=this;if(this._observers[e])for(var n=this._observers[e].length-1;n>=0;n--)r._observers[e][n](t)};var P=function(){this._resizeHandler=null,this._proxy=parent,this.controller=new C,this._registerMessageListeners()};P.prototype.publish=function(e,t){this._proxy.postMessage({method:"notifyController",params:{topic:e,value:t}},"*")},P.prototype._registerMessageListeners=function(){var t=this;window.addEventListener("message",function(r){var n=r.data.method,o=r.data.params;"notifyView"===n?t.controller.publish(o.topic,o.value):t[n]?t[n](o):e.warn("[SiftView]: method not implemented: ",n)},!1)};var D=function(e){function t(t){e.call(this),this._proxy=t}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.goto=function(e){this._postMessage("goto",e)},t.prototype.close=function(){this._postMessage("close")},t.prototype._postMessage=function(e,t){this._proxy.postMessage({method:"notifyClient",params:{topic:e,value:t}})},t}(C),q=function(e){function t(){e.call(this),this._storage=null}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.init=function(e){this._storage=e},t.prototype.get=function(e){return this._storage.get(e)},t.prototype.getIndexKeys=function(e){return this._storage.getIndexKeys(e)},t.prototype.getIndex=function(e){return this._storage.getIndex(e)},t.prototype.getWithIndex=function(e){return this._storage.getWithIndex(e)},t.prototype.getAllKeys=function(e){return this._storage.getAllKeys(e)},t.prototype.getAll=function(e){return this._storage.getAll(e)},t.prototype.getUser=function(e){return this._storage.getUser(e)},t.prototype.putUser=function(e){return this._storage.putUser(e)},t.prototype.delUser=function(e){return this._storage.delUser(e)},t}(C),L="undefined"!=typeof window?window:"undefined"!=typeof i?i:"undefined"!=typeof self?self:{},R=u(function(i){!function(e,u){"use strict";n=u,o="function"==typeof n?n.call(t,r,t,i):n,!(void 0!==o&&(i.exports=o))}(L,function(){"use strict";function t(t){return typeof e!==a&&(void 0!==e[t]?r(e,t):void 0!==e.log?r(e,"log"):s)}function r(e,t){var r=e[t];if("function"==typeof r.bind)return r.bind(e);try{return Function.prototype.bind.call(r,e)}catch(t){return function(){return Function.prototype.apply.apply(r,[e,arguments])}}}function n(t,r,n){return function(){typeof e!==a&&(o.call(this,r,n),this[t].apply(this,arguments))}}function o(e,t){for(var r=this,n=0;n<c.length;n++){var o=c[n];r[o]=n<e?s:r.methodFactory(o,e,t)}}function i(e,r,o){return t(e)||n.apply(this,arguments)}function u(t,r,n){function u(e){var t=(c[e]||"silent").toUpperCase();try{return void(window.localStorage[p]=t)}catch(e){}try{window.document.cookie=encodeURIComponent(p)+"="+t+";"}catch(e){}}function s(){var e;try{e=window.localStorage[p]}catch(e){}if(typeof e===a)try{var t=window.document.cookie,r=t.indexOf(encodeURIComponent(p)+"=");r&&(e=/^([^;]+)/.exec(t.slice(r))[1])}catch(e){}return void 0===l.levels[e]&&(e=void 0),e}var f,l=this,p="loglevel";t&&(p+=":"+t),l.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},l.methodFactory=n||i,l.getLevel=function(){return f},l.setLevel=function(r,n){if("string"==typeof r&&void 0!==l.levels[r.toUpperCase()]&&(r=l.levels[r.toUpperCase()]),!("number"==typeof r&&r>=0&&r<=l.levels.SILENT))throw"log.setLevel() called with invalid level: "+r;if(f=r,n!==!1&&u(r),o.call(l,r,t),typeof e===a&&r<l.levels.SILENT)return"No console available for logging"},l.setDefaultLevel=function(e){s()||l.setLevel(e,!1)},l.enableAll=function(e){l.setLevel(l.levels.TRACE,e)},l.disableAll=function(e){l.setLevel(l.levels.SILENT,e)};var d=s();null==d&&(d=null==r?"WARN":r),l.setLevel(d,!1)}var s=function(){},a="undefined",c=["trace","debug","info","warn","error"],f=new u,l={};f.getLogger=function(e){if("string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=l[e];return t||(t=l[e]=new u(e,f.getLevel(),f.methodFactory)),t};var p=typeof window!==a?window.log:void 0;return f.noConflict=function(){return typeof window!==a&&window.log===f&&(window.log=p),f},f})}),N=R&&"object"==typeof R&&"default"in R?R.default:R,U=u(function(e){"use strict";var t=Object.prototype.toString;e.exports=function(e){var r;return"[object Object]"===t.call(e)&&(r=Object.getPrototypeOf(e),null===r||r===Object.getPrototypeOf({}))}}),G=U&&"object"==typeof U&&"default"in U?U.default:U,K=u(function(e,t){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function n(e){var t=L.IDBKeyRange||L.webkitIDBKeyRange;if(e instanceof t)return e;if("undefined"==typeof e||null===e)return null;if(!(0,i.default)(e))return t.only(e);var r=Object.keys(e).sort();if(1===r.length){var n=r[0],o=e[n];switch(n){case"eq":return t.only(o);case"gt":return t.lowerBound(o,!0);case"lt":return t.upperBound(o,!0);case"gte":return t.lowerBound(o);case"lte":return t.upperBound(o);default:throw new TypeError('"'+n+'" is not valid key')}}else{var u=e[r[0]],s=e[r[1]],a=r.join("-");switch(a){case"gt-lt":return t.bound(u,s,!0,!0);case"gt-lte":return t.bound(u,s,!0,!1);case"gte-lt":return t.bound(u,s,!1,!0);case"gte-lte":return t.bound(u,s,!1,!1);default:throw new TypeError('"'+a+'" are conflicted keys')}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n;var o=G,i=r(o);e.exports=t.default}),M=K&&"object"==typeof K&&"default"in K?K.default:K,B=u(function(e){function t(e,t,r,n){this.store=e,this.name=t,this.field=r,this.opts=n,this.multi=n.multi||n.multiEntry||!1,this.unique=n.unique||!1}var r=M;e.exports=t,t.prototype.get=function(e,t){function r(e){n.push(e.value),e.continue()}var n=[],o=this.unique,i={range:e,iterator:r};this.cursor(i,function(e){return e?t(e):void(o?t(null,n[0]):t(null,n))})},t.prototype.count=function(e,t){var n=this.store.name,o=this.name;this.store.db.transaction("readonly",[n],function(i,u){if(i)return t(i);var s=u.objectStore(n).index(o),a=s.count(r(e));a.onerror=t,a.onsuccess=function(e){t(null,e.target.result)}})},t.prototype.cursor=function(e,t){e.index=this.name,this.store.cursor(e,t)}}),V=B&&"object"==typeof B&&"default"in B?B.default:B,z=u(function(e){var t=Object.prototype.toString;e.exports=function(e){switch(t.call(e)){case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array";case"[object Error]":return"error"}return null===e?"null":void 0===e?"undefined":e!==e?"nan":e&&1===e.nodeType?"element":(e=e.valueOf?e.valueOf():Object.prototype.valueOf.apply(e),typeof e)}}),F=z&&"object"==typeof z&&"default"in z?z.default:z,Q=u(function(e){function t(e,t){this.db=null,this.name=e,this.indexes={},this.opts=t,this.key=t.key||t.keyPath||void 0,this.increment=t.increment||t.autoIncretement||void 0}var r=F,n=M;e.exports=t,t.prototype.index=function(e){return this.indexes[e]},t.prototype.put=function(e,t,n){var o=this.name,i=this.key;i&&("object"==r(e)?(n=t,t=e,e=null):t[i]=e),this.db.transaction("readwrite",[o],function(r,u){if(r)return n(r);var s=u.objectStore(o),a=i?s.put(t):s.put(t,e);u.onerror=u.onabort=a.onerror=n,u.oncomplete=function(){n(null,a.result)}})},t.prototype.get=function(e,t){var r=this.name;this.db.transaction("readonly",[r],function(n,o){if(n)return t(n);var i=o.objectStore(r),u=i.get(e);u.onerror=t,u.onsuccess=function(e){t(null,e.target.result)}})},t.prototype.del=function(e,t){var r=this.name;this.db.transaction("readwrite",[r],function(n,o){if(n)return t(n);var i=o.objectStore(r),u=i.delete(e);o.onerror=o.onabort=u.onerror=t,o.oncomplete=function(){t()}})},t.prototype.count=function(e){var t=this.name;this.db.transaction("readonly",[t],function(r,n){if(r)return e(r);var o=n.objectStore(t),i=o.count();i.onerror=e,i.onsuccess=function(t){e(null,t.target.result)}})},t.prototype.clear=function(e){var t=this.name;this.db.transaction("readwrite",[t],function(r,n){if(r)return e(r);var o=n.objectStore(t),i=o.clear();n.onerror=n.onabort=i.onerror=e,n.oncomplete=function(){e()}})},t.prototype.batch=function(e,t){var r=this.name,n=this.key,o=Object.keys(e);this.db.transaction("readwrite",[r],function(i,u){function s(){if(!(c>=o.length)){var r,i=o[c],u=e[i];null===u?r=a.delete(i):n?(u[n]||(u[n]=i),r=a.put(u)):r=a.put(u,i),r.onerror=t,r.onsuccess=s,c+=1}}if(i)return t(i);var a=u.objectStore(r),c=0;u.onerror=u.onabort=t,u.oncomplete=function(){t()},s()})},t.prototype.all=function(e){function t(e){r.push(e.value),e.continue()}var r=[];this.cursor({iterator:t},function(t){t?e(t):e(null,r)})},t.prototype.cursor=function(e,t){var r=this.name;this.db.transaction("readonly",[r],function(o,i){if(o)return t(o);var u=e.index?i.objectStore(r).index(e.index):i.objectStore(r),s=u.openCursor(n(e.range));s.onerror=t,s.onsuccess=function(r){var n=r.target.result;n?e.iterator(n):t()}})}}),W=Q&&"object"==typeof Q&&"default"in Q?Q.default:Q,$=u(function(e){function t(){return this instanceof t?(this._stores={},this._current={},void(this._versions={})):new t}var r=F,n=W,o=V;e.exports=t,t.prototype.version=function(e){if("number"!=r(e)||e<1||e<this.getVersion())throw new TypeError("not valid version");return this._current={version:e,store:null},this._versions[e]={stores:[],dropStores:[],indexes:[],dropIndexes:[],version:e},this},t.prototype.addStore=function(e,t){if("string"!=r(e))throw new TypeError("`name` is required");if(this._stores[e])throw new TypeError("store is already defined");var o=new n(e,t||{});return this._stores[e]=o,this._versions[this.getVersion()].stores.push(o),this._current.store=o,this},t.prototype.dropStore=function(e){if("string"!=r(e))throw new TypeError("`name` is required");var t=this._stores[e];if(!t)throw new TypeError("store is not defined");return delete this._stores[e],this._versions[this.getVersion()].dropStores.push(t),this},t.prototype.addIndex=function(e,t,n){if("string"!=r(e))throw new TypeError("`name` is required");if("string"!=r(t)&&"array"!=r(t))throw new TypeError("`field` is required");var i=this._current.store;if(i.indexes[e])throw new TypeError("index is already defined");var u=new o(i,e,t,n||{});return i.indexes[e]=u,this._versions[this.getVersion()].indexes.push(u),this},t.prototype.dropIndex=function(e){if("string"!=r(e))throw new TypeError("`name` is required");var t=this._current.store.indexes[e];if(!t)throw new TypeError("index is not defined");return delete this._current.store.indexes[e],this._versions[this.getVersion()].dropIndexes.push(t),this},t.prototype.getStore=function(e){if("string"!=r(e))throw new TypeError("`name` is required");if(!this._stores[e])throw new TypeError("store is not defined");return this._current.store=this._stores[e],this},t.prototype.getVersion=function(){return this._current.version},t.prototype.callback=function(){var e=Object.keys(this._versions).map(function(e){return this._versions[e]},this).sort(function(e,t){return e.version-t.version});return function(t){var r=t.target.result,n=t.target.transaction;e.forEach(function(e){t.oldVersion>=e.version||(e.stores.forEach(function(e){var t={};"undefined"!=typeof e.key&&(t.keyPath=e.key),"undefined"!=typeof e.increment&&(t.autoIncrement=e.increment),r.createObjectStore(e.name,t)}),e.dropStores.forEach(function(e){r.deleteObjectStore(e.name)}),e.indexes.forEach(function(e){var t=n.objectStore(e.store.name);t.createIndex(e.name,e.field,{unique:e.unique,multiEntry:e.multi})}),e.dropIndexes.forEach(function(e){var t=n.objectStore(e.store.name);t.deleteIndex(e.name)}))})}}}),H=$&&"object"==typeof $&&"default"in $?$.default:$,J=u(function(e,t){function r(e,t){if(!(this instanceof r))return new r(e,t);if("string"!=i(e))throw new TypeError("`name` required");if(!(t instanceof u))throw new TypeError("not valid schema");this.name=e,this.status="close",this.origin=null,this.stores=t._stores,this.version=t.getVersion(),this.onupgradeneeded=t.callback(),Object.keys(this.stores).forEach(function(e){this.stores[e].db=this},this)}function n(){return o().cmp.apply(o(),arguments)}function o(){return L._indexedDB||L.indexedDB||L.msIndexedDB||L.mozIndexedDB||L.webkitIndexedDB}var i=F,u=H,s=W,a=V;t=e.exports=r,t.schema=u,t.cmp=n,t.Treo=r,t.Schema=u,t.Store=s,t.Index=a,r.prototype.use=function(e){return e(this,t),this},r.prototype.drop=function(e){var t=this.name;this.close(function(r){if(r)return e(r);var n=o().deleteDatabase(t);n.onerror=e,n.onsuccess=function(){e()}})},r.prototype.close=function(e){return"close"==this.status?e():void this.getInstance(function(t,r){return t?e(t):(r.origin=null,r.status="close",r.close(),void e())})},r.prototype.store=function(e){return this.stores[e]},r.prototype.getInstance=function(e){if("open"==this.status)return e(null,this.origin);if("opening"==this.status)return this.queue.push(e);this.status="opening",this.queue=[e];var t=this,r=o().open(this.name,this.version);r.onupgradeneeded=this.onupgradeneeded,r.onerror=r.onblocked=function(e){t.status="error",t.queue.forEach(function(t){t(e)}),delete t.queue},r.onsuccess=function(e){t.origin=e.target.result,t.status="open",t.origin.onversionchange=function(){t.close(function(){})},t.queue.forEach(function(e){e(null,t.origin)}),delete t.queue}},r.prototype.transaction=function(e,t,r){this.getInstance(function(n,o){n?r(n):r(null,o.transaction(t,e))})}}),Z=J&&"object"==typeof J&&"default"in J?J.default:J,Y=N.getLogger("RSStorage:operations");Y.setLevel("warn");var X=["_email.id","_email.tid"],ee=[[{name:"_id.list",indexes:["sift.guid"]},{name:"_tid.list",indexes:["sift.guid"]}],[{name:"_email.id",indexes:["sift.guid"]},{name:"_email.tid",indexes:["sift.guid"]},{name:"_id.list",drop:!0},{name:"_tid.list",drop:!0}]],te=[{name:"events",indexes:["value.sift.guid"]},{name:"admin"}],re=[{name:"tour"},{name:"spm"},{name:"auth"}],ne=new WeakMap,oe=new WeakMap,ie=function(e,t){if(this._logger=N.getLogger("RSStorage"),this._logger.setLevel(t||"warn"),!e.accountGuid)throw new Error("[Storage]: dbInfo.accountGuid undefined");ne.set(this,e.siftGuid),oe.set(this,s(e))};ie.prototype.get=function(e){return this._logger.trace("[Storage::get]: ",e),c(oe.get(this),e,ne.get(this))},ie.prototype.getAll=function(e){return this._logger.trace("[Storage::getAll]: ",e),f(oe.get(this),e,ne.get(this))},ie.prototype.getAllKeys=function(e){return this._logger.trace("[Storage::getAllKeys]: ",e),l(oe.get(this),e,ne.get(this))},ie.prototype.getIndex=function(e){return this._logger.trace("[Storage::getIndex]: ",e),p(oe.get(this),e,ne.get(this))},ie.prototype.getIndexKeys=function(e){return this._logger.trace("[Storage::getIndexKeys]: ",e),d(oe.get(this),e,ne.get(this))},ie.prototype.getWithIndex=function(e){return this._logger.trace("[Storage::getWithIndex]: ",e),h(oe.get(this),e,ne.get(this))},ie.prototype.delUser=function(e){return e.bucket="_user.default",this._logger.trace("[Storage::delUser]: ",e),a(oe.get(this),e,ne.get(this))},ie.prototype.getUser=function(e){return e.bucket="_user.default",this._logger.trace("[Storage::getUser]: ",e),c(oe.get(this),e,ne.get(this))},ie.prototype.putUser=function(e){return e.bucket="_user.default",this._logger.trace("[Storage::putUser]: ",e),e.kvs&&0!==e.kvs.length?g(oe.get(this),e,!1,ne.get(this)):Promise.reject("[Storage::putUser]: params.kvs undefined")};var ue=function(){this._proxy=self,this.view=new C,this.emailclient=new D(self),this._registerMessageListeners()};ue.prototype.publish=function(e,t){this._proxy.postMessage({method:"notifyView",params:{topic:e,value:t}})},ue.prototype._registerMessageListeners=function(){var e=this;this._proxy&&(this._proxy.onmessage=function(t){var r=t.data.method;e["_"+r]&&e["_"+r](t.data.params)})},ue.prototype._init=function(e){this.storage=new q,this.storage.init(new ie({type:"SIFT",siftGuid:e.siftGuid,accountGuid:e.accountGuid,schema:e.dbSchema})),this._guid=e.siftGuid,this._account=e.accountGuid,this._proxy.postMessage({method:"initCallback",result:e})},ue.prototype._terminate=function(){this._proxy&&this._proxy.close()},ue.prototype._postCallback=function(e,t){this._proxy.postMessage({method:"loadViewCallback",params:{user:{guid:this._account},sift:{guid:this._guid},type:e.type,sizeClass:e.sizeClass,result:t}})},ue.prototype._loadView=function(t){var r=this;if(!this.loadView)return void e.error("[SiftController::_loadView]: Sift controller must implement the loadView method");var n=this.loadView({sizeClass:t.sizeClass,type:t.type,params:t.data});n.data&&"function"==typeof n.data.then?(n.html&&this._postCallback(t,{html:n.html}),n.data.then(function(e){r._postCallback(t,{html:n.html,data:e})}).catch(function(t){e.error("[SiftController::loadView]: promise rejected: ",t)})):this._postCallback(t,n)},ue.prototype._storageUpdated=function(e){var t=this;this.storage.publish("*",e),e.forEach(function(e){t.storage.publish(e,[e])})},ue.prototype._notifyController=function(e){this.view.publish(e.topic,e.value)},ue.prototype._emailComposer=function(e){this.emailclient.publish(e.topic,e.value)},t.EmailClientController=A,t.SiftController=ue,t.SiftStorage=q,t.SiftView=P,t.registerSiftView=E,t.createSiftView=x,t.createSiftController=S,t.registerSiftController=I,t.createEmailClientController=O,t.registerEmailClientController=T,Object.defineProperty(t,"__esModule",{value:!0})})}).call(t,r(2),function(){return this}())},function(e,t,r){(function(t){function n(){}function o(){p.log.apply(p,arguments)}function i(){p.log.apply(p,arguments)}function u(){p.warn.apply(p,arguments)}function s(e){v[e]=g()}function a(e){var t=v[e];if(!t)throw new Error("No such label: "+e);var r=g()-t;p.log(e+": "+r+"ms")}function c(){var e=new Error;e.name="Trace",e.message=d.format.apply(null,arguments),p.error(e.stack)}function f(e){p.log(d.inspect(e)+"\n")}function l(e){if(!e){var t=y.call(arguments,1);h.ok(!1,d.format.apply(null,t))}}var p,d=r(3),h=r(7),g=r(8),y=Array.prototype.slice,v={};p="undefined"!=typeof t&&t.console?t.console:"undefined"!=typeof window&&window.console?window.console:{};for(var m=[[n,"log"],[o,"info"],[i,"warn"],[u,"error"],[s,"time"],[a,"timeEnd"],[c,"trace"],[f,"dir"],[l,"assert"]],b=0;b<m.length;b++){var _=m[b],w=_[0],k=_[1];p[k]||(p[k]=w)}e.exports=p}).call(t,function(){return this}())},function(e,t,r){(function(e,n,o){function i(e,r){var n={seen:[],stylize:s};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),y(r)?n.showHidden=r:r&&t._extend(n,r),k(n.showHidden)&&(n.showHidden=!1),k(n.depth)&&(n.depth=2),k(n.colors)&&(n.colors=!1),k(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=u),c(n,e,n.depth)}function u(e,t){var r=i.styles[t];return r?"["+i.colors[r][0]+"m"+e+"["+i.colors[r][1]+"m":e}function s(e,t){return e}function a(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}function c(e,r,n){if(e.customInspect&&r&&O(r.inspect)&&r.inspect!==t.inspect&&(!r.constructor||r.constructor.prototype!==r)){var o=r.inspect(n,e);return _(o)||(o=c(e,o,n)),o}var i=f(e,r);if(i)return i;var u=Object.keys(r),s=a(u);if(e.showHidden&&(u=Object.getOwnPropertyNames(r)),I(r)&&(u.indexOf("message")>=0||u.indexOf("description")>=0))return l(r);if(0===u.length){if(O(r)){var y=r.name?": "+r.name:"";return e.stylize("[Function"+y+"]","special")}if(E(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(S(r))return e.stylize(Date.prototype.toString.call(r),"date");if(I(r))return l(r)}var v="",m=!1,b=["{","}"];if(g(r)&&(m=!0,b=["[","]"]),O(r)){var w=r.name?": "+r.name:"";v=" [Function"+w+"]"}if(E(r)&&(v=" "+RegExp.prototype.toString.call(r)),S(r)&&(v=" "+Date.prototype.toUTCString.call(r)),I(r)&&(v=" "+l(r)),0===u.length&&(!m||0==r.length))return b[0]+v+b[1];if(n<0)return E(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special");e.seen.push(r);var k;return k=m?p(e,r,n,s,u):u.map(function(t){return d(e,r,n,s,t,m)}),e.seen.pop(),h(k,v,b)}function f(e,t){if(k(t))return e.stylize("undefined","undefined");if(_(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}return b(t)?e.stylize(""+t,"number"):y(t)?e.stylize(""+t,"boolean"):v(t)?e.stylize("null","null"):void 0}function l(e){return"["+Error.prototype.toString.call(e)+"]"}function p(e,t,r,n,o){for(var i=[],u=0,s=t.length;u<s;++u)P(t,String(u))?i.push(d(e,t,r,n,String(u),!0)):i.push("");return o.forEach(function(o){o.match(/^\d+$/)||i.push(d(e,t,r,n,o,!0))}),i}function d(e,t,r,n,o,i){
var u,s,a;if(a=Object.getOwnPropertyDescriptor(t,o)||{value:t[o]},a.get?s=a.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):a.set&&(s=e.stylize("[Setter]","special")),P(n,o)||(u="["+o+"]"),s||(e.seen.indexOf(a.value)<0?(s=v(r)?c(e,a.value,null):c(e,a.value,r-1),s.indexOf("\n")>-1&&(s=i?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n"))):s=e.stylize("[Circular]","special")),k(u)){if(i&&o.match(/^\d+$/))return s;u=JSON.stringify(""+o),u.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(u=u.substr(1,u.length-2),u=e.stylize(u,"name")):(u=u.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),u=e.stylize(u,"string"))}return u+": "+s}function h(e,t,r){var n=0,o=e.reduce(function(e,t){return n++,t.indexOf("\n")>=0&&n++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0);return o>60?r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]:r[0]+t+" "+e.join(", ")+" "+r[1]}function g(e){return Array.isArray(e)}function y(e){return"boolean"==typeof e}function v(e){return null===e}function m(e){return null==e}function b(e){return"number"==typeof e}function _(e){return"string"==typeof e}function w(e){return"symbol"==typeof e}function k(e){return void 0===e}function E(e){return x(e)&&"[object RegExp]"===j(e)}function x(e){return"object"==typeof e&&null!==e}function S(e){return x(e)&&"[object Date]"===j(e)}function I(e){return x(e)&&("[object Error]"===j(e)||e instanceof Error)}function O(e){return"function"==typeof e}function T(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||"undefined"==typeof e}function j(e){return Object.prototype.toString.call(e)}function A(e){return e<10?"0"+e.toString(10):e.toString(10)}function C(){var e=new Date,t=[A(e.getHours()),A(e.getMinutes()),A(e.getSeconds())].join(":");return[e.getDate(),R[e.getMonth()],t].join(" ")}function P(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var D=/%[sdj%]/g;t.format=function(e){if(!_(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(i(arguments[r]));return t.join(" ")}for(var r=1,n=arguments,o=n.length,u=String(e).replace(D,function(e){if("%%"===e)return"%";if(r>=o)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}}),s=n[r];r<o;s=n[++r])u+=v(s)||!x(s)?" "+s:" "+i(s);return u},t.deprecate=function(r,i){function u(){if(!s){if(n.throwDeprecation)throw new Error(i);n.traceDeprecation?o.trace(i):o.error(i),s=!0}return r.apply(this,arguments)}if(k(e.process))return function(){return t.deprecate(r,i).apply(this,arguments)};if(n.noDeprecation===!0)return r;var s=!1;return u};var q,L={};t.debuglog=function(e){if(k(q)&&(q=n.env.NODE_DEBUG||""),e=e.toUpperCase(),!L[e])if(new RegExp("\\b"+e+"\\b","i").test(q)){var r=n.pid;L[e]=function(){var n=t.format.apply(t,arguments);o.error("%s %d: %s",e,r,n)}}else L[e]=function(){};return L[e]},t.inspect=i,i.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},i.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=g,t.isBoolean=y,t.isNull=v,t.isNullOrUndefined=m,t.isNumber=b,t.isString=_,t.isSymbol=w,t.isUndefined=k,t.isRegExp=E,t.isObject=x,t.isDate=S,t.isError=I,t.isFunction=O,t.isPrimitive=T,t.isBuffer=r(5);var R=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];t.log=function(){o.log("%s - %s",C(),t.format.apply(t,arguments))},t.inherits=r(6),t._extend=function(e,t){if(!t||!x(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}).call(t,function(){return this}(),r(4),r(2))},function(e,t){function r(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function o(e){if(f===setTimeout)return setTimeout(e,0);if((f===r||!f)&&setTimeout)return f=setTimeout,setTimeout(e,0);try{return f(e,0)}catch(t){try{return f.call(null,e,0)}catch(t){return f.call(this,e,0)}}}function i(e){if(l===clearTimeout)return clearTimeout(e);if((l===n||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(e);try{return l(e)}catch(t){try{return l.call(null,e)}catch(t){return l.call(this,e)}}}function u(){g&&d&&(g=!1,d.length?h=d.concat(h):y=-1,h.length&&s())}function s(){if(!g){var e=o(u);g=!0;for(var t=h.length;t;){for(d=h,h=[];++y<t;)d&&d[y].run();y=-1,t=h.length}d=null,g=!1,i(e)}}function a(e,t){this.fun=e,this.array=t}function c(){}var f,l,p=e.exports={};!function(){try{f="function"==typeof setTimeout?setTimeout:r}catch(e){f=r}try{l="function"==typeof clearTimeout?clearTimeout:n}catch(e){l=n}}();var d,h=[],g=!1,y=-1;p.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];h.push(new a(e,t)),1!==h.length||g||o(s)},a.prototype.run=function(){this.fun.apply(null,this.array)},p.title="browser",p.browser=!0,p.env={},p.argv=[],p.version="",p.versions={},p.on=c,p.addListener=c,p.once=c,p.off=c,p.removeListener=c,p.removeAllListeners=c,p.emit=c,p.binding=function(e){throw new Error("process.binding is not supported")},p.cwd=function(){return"/"},p.chdir=function(e){throw new Error("process.chdir is not supported")},p.umask=function(){return 0}},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},function(e,t,r){(function(t){"use strict";/*!
	 * The buffer module from node.js, for the browser.
	 *
	 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
	 * @license  MIT
	 */
function n(e,t){if(e===t)return 0;for(var r=e.length,n=t.length,o=0,i=Math.min(r,n);o<i;++o)if(e[o]!==t[o]){r=e[o],n=t[o];break}return r<n?-1:n<r?1:0}function o(e){return t.Buffer&&"function"==typeof t.Buffer.isBuffer?t.Buffer.isBuffer(e):!(null==e||!e._isBuffer)}function i(e){return Object.prototype.toString.call(e)}function u(e){return!o(e)&&("function"==typeof t.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):!!e&&(e instanceof DataView||!!(e.buffer&&e.buffer instanceof ArrayBuffer))))}function s(e){if(_.isFunction(e)){if(E)return e.name;var t=e.toString(),r=t.match(S);return r&&r[1]}}function a(e,t){return"string"==typeof e?e.length<t?e:e.slice(0,t):e}function c(e){if(E||!_.isFunction(e))return _.inspect(e);var t=s(e),r=t?": "+t:"";return"[Function"+r+"]"}function f(e){return a(c(e.actual),128)+" "+e.operator+" "+a(c(e.expected),128)}function l(e,t,r,n,o){throw new x.AssertionError({message:r,actual:e,expected:t,operator:n,stackStartFunction:o})}function p(e,t){e||l(e,!0,t,"==",x.ok)}function d(e,t,r,s){if(e===t)return!0;if(o(e)&&o(t))return 0===n(e,t);if(_.isDate(e)&&_.isDate(t))return e.getTime()===t.getTime();if(_.isRegExp(e)&&_.isRegExp(t))return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(null!==e&&"object"==typeof e||null!==t&&"object"==typeof t){if(u(e)&&u(t)&&i(e)===i(t)&&!(e instanceof Float32Array||e instanceof Float64Array))return 0===n(new Uint8Array(e.buffer),new Uint8Array(t.buffer));if(o(e)!==o(t))return!1;s=s||{actual:[],expected:[]};var a=s.actual.indexOf(e);return a!==-1&&a===s.expected.indexOf(t)||(s.actual.push(e),s.expected.push(t),g(e,t,r,s))}return r?e===t:e==t}function h(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function g(e,t,r,n){if(null===e||void 0===e||null===t||void 0===t)return!1;if(_.isPrimitive(e)||_.isPrimitive(t))return e===t;if(r&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;var o=h(e),i=h(t);if(o&&!i||!o&&i)return!1;if(o)return e=k.call(e),t=k.call(t),d(e,t,r);var u,s,a=I(e),c=I(t);if(a.length!==c.length)return!1;for(a.sort(),c.sort(),s=a.length-1;s>=0;s--)if(a[s]!==c[s])return!1;for(s=a.length-1;s>=0;s--)if(u=a[s],!d(e[u],t[u],r,n))return!1;return!0}function y(e,t,r){d(e,t,!0)&&l(e,t,r,"notDeepStrictEqual",y)}function v(e,t){if(!e||!t)return!1;if("[object RegExp]"==Object.prototype.toString.call(t))return t.test(e);try{if(e instanceof t)return!0}catch(e){}return!Error.isPrototypeOf(t)&&t.call({},e)===!0}function m(e){var t;try{e()}catch(e){t=e}return t}function b(e,t,r,n){var o;if("function"!=typeof t)throw new TypeError('"block" argument must be a function');"string"==typeof r&&(n=r,r=null),o=m(t),n=(r&&r.name?" ("+r.name+").":".")+(n?" "+n:"."),e&&!o&&l(o,r,"Missing expected exception"+n);var i="string"==typeof n,u=!e&&_.isError(o),s=!e&&o&&!r;if((u&&i&&v(o,r)||s)&&l(o,r,"Got unwanted exception"+n),e&&o&&r&&!v(o,r)||!e&&o)throw o}var _=r(3),w=Object.prototype.hasOwnProperty,k=Array.prototype.slice,E=function(){return"foo"===function(){}.name}(),x=e.exports=p,S=/\s*function\s+([^\(\s]*)\s*/;x.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=f(this),this.generatedMessage=!0);var t=e.stackStartFunction||l;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var r=new Error;if(r.stack){var n=r.stack,o=s(t),i=n.indexOf("\n"+o);if(i>=0){var u=n.indexOf("\n",i+1);n=n.substring(u+1)}this.stack=n}}},_.inherits(x.AssertionError,Error),x.fail=l,x.ok=p,x.equal=function(e,t,r){e!=t&&l(e,t,r,"==",x.equal)},x.notEqual=function(e,t,r){e==t&&l(e,t,r,"!=",x.notEqual)},x.deepEqual=function(e,t,r){d(e,t,!1)||l(e,t,r,"deepEqual",x.deepEqual)},x.deepStrictEqual=function(e,t,r){d(e,t,!0)||l(e,t,r,"deepStrictEqual",x.deepStrictEqual)},x.notDeepEqual=function(e,t,r){d(e,t,!1)&&l(e,t,r,"notDeepEqual",x.notDeepEqual)},x.notDeepStrictEqual=y,x.strictEqual=function(e,t,r){e!==t&&l(e,t,r,"===",x.strictEqual)},x.notStrictEqual=function(e,t,r){e===t&&l(e,t,r,"!==",x.notStrictEqual)},x.throws=function(e,t,r){b(!0,e,t,r)},x.doesNotThrow=function(e,t,r){b(!1,e,t,r)},x.ifError=function(e){if(e)throw e};var I=Object.keys||function(e){var t=[];for(var r in e)w.call(e,r)&&t.push(r);return t}}).call(t,function(){return this}())},function(e,t){function r(){return(new Date).getTime()}e.exports=r},function(e,t,r){var n,o=function(e){function t(){ae=new Array(128),ce={w:G,b:G},fe=U,le={w:0,b:0},pe=G,de=0,he=1,ge=[],ye={},s(i())}function r(){n(W)}function n(e){var r=e.split(/\s+/),n=r[0],u=0;if(!o(e).valid)return!1;t();for(var a=0;a<n.length;a++){var f=n.charAt(a);if("/"===f)u+=8;else if(P(f))u+=parseInt(f,10);else{var l=f<"a"?U:N;c({type:f.toLowerCase(),color:l},A(u)),u++}}return fe=r[1],r[2].indexOf("K")>-1&&(le.w|=te.KSIDE_CASTLE),r[2].indexOf("Q")>-1&&(le.w|=te.QSIDE_CASTLE),r[2].indexOf("k")>-1&&(le.b|=te.KSIDE_CASTLE),r[2].indexOf("q")>-1&&(le.b|=te.QSIDE_CASTLE),pe="-"===r[3]?G:ue[r[3]],de=parseInt(r[4],10),he=parseInt(r[5],10),s(i()),!0}function o(e){var t={0:"No errors.",1:"FEN string must contain six space-delimited fields.",2:"6th field (move number) must be a positive integer.",3:"5th field (half move counter) must be a non-negative integer.",4:"4th field (en-passant square) is invalid.",5:"3rd field (castling availability) is invalid.",6:"2nd field (side to move) is invalid.",7:"1st field (piece positions) does not contain 8 '/'-delimited rows.",8:"1st field (piece positions) is invalid [consecutive numbers].",9:"1st field (piece positions) is invalid [invalid piece].",10:"1st field (piece positions) is invalid [row too large].",11:"Illegal en-passant square"},r=e.split(/\s+/);if(6!==r.length)return{valid:!1,error_number:1,error:t[1]};if(isNaN(r[5])||parseInt(r[5],10)<=0)return{valid:!1,error_number:2,error:t[2]};if(isNaN(r[4])||parseInt(r[4],10)<0)return{valid:!1,error_number:3,error:t[3]};if(!/^(-|[abcdefgh][36])$/.test(r[3]))return{valid:!1,error_number:4,error:t[4]};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(r[2]))return{valid:!1,error_number:5,error:t[5]};if(!/^(w|b)$/.test(r[1]))return{valid:!1,error_number:6,error:t[6]};var n=r[0].split("/");if(8!==n.length)return{valid:!1,error_number:7,error:t[7]};for(var o=0;o<n.length;o++){for(var i=0,u=!1,s=0;s<n[o].length;s++)if(isNaN(n[o][s])){if(!/^[prnbqkPRNBQK]$/.test(n[o][s]))return{valid:!1,error_number:9,error:t[9]};i+=1,u=!1}else{if(u)return{valid:!1,error_number:8,error:t[8]};i+=parseInt(n[o][s],10),u=!0}if(8!==i)return{valid:!1,error_number:10,error:t[10]}}return"3"==r[3][1]&&"w"==r[1]||"6"==r[3][1]&&"b"==r[1]?{valid:!1,error_number:11,error:t[11]}:{valid:!0,error_number:0,error:t[0]}}function i(){for(var e=0,t="",r=ue.a8;r<=ue.h1;r++){if(null==ae[r])e++;else{e>0&&(t+=e,e=0);var n=ae[r].color,o=ae[r].type;t+=n===U?o.toUpperCase():o.toLowerCase()}r+1&136&&(e>0&&(t+=e),r!==ue.h1&&(t+="/"),e=0,r+=8)}var i="";le[U]&te.KSIDE_CASTLE&&(i+="K"),le[U]&te.QSIDE_CASTLE&&(i+="Q"),le[N]&te.KSIDE_CASTLE&&(i+="k"),le[N]&te.QSIDE_CASTLE&&(i+="q"),i=i||"-";var u=pe===G?"-":A(pe);return[t,fe,i,u,de,he].join(" ")}function u(e){for(var t=0;t<e.length;t+=2)"string"==typeof e[t]&&"string"==typeof e[t+1]&&(ye[e[t]]=e[t+1]);return ye}function s(e){ge.length>0||(e!==W?(ye.SetUp="1",ye.FEN=e):(delete ye.SetUp,delete ye.FEN))}function a(e){var t=ae[ue[e]];return t?{type:t.type,color:t.color}:null}function c(e,t){if(!("type"in e&&"color"in e))return!1;if(Q.indexOf(e.type.toLowerCase())===-1)return!1;if(!(t in ue))return!1;var r=ue[t];return(e.type!=F||ce[e.color]==G||ce[e.color]==r)&&(ae[r]={type:e.type,color:e.color},e.type===F&&(ce[e.color]=r),s(i()),!0)}function f(e){var t=a(e);return ae[ue[e]]=null,t&&t.type===F&&(ce[t.color]=G),s(i()),t}function l(e,t,r,n,o){var i={color:fe,from:t,to:r,flags:n,piece:e[t].type};return o&&(i.flags|=te.PROMOTION,i.promotion=o),e[r]?i.captured=e[r].type:n&te.EP_CAPTURE&&(i.captured=K),i}function p(e){function t(e,t,r,n,o){if(e[r].type!==K||T(n)!==ie&&T(n)!==re)t.push(l(e,r,n,o));else for(var i=[z,V,B,M],u=0,s=i.length;u<s;u++)t.push(l(e,r,n,o,i[u]))}var r=[],n=fe,o=C(n),i={b:oe,w:ne},u=ue.a8,s=ue.h1,a=!1,c=!("undefined"!=typeof e&&"legal"in e)||e.legal;if("undefined"!=typeof e&&"square"in e){if(!(e.square in ue))return[];u=s=ue[e.square],a=!0}for(var f=u;f<=s;f++)if(136&f)f+=7;else{var p=ae[f];if(null!=p&&p.color===n)if(p.type===K){var d=f+H[n][0];if(null==ae[d]){t(ae,r,f,d,te.NORMAL);var d=f+H[n][1];i[n]===T(f)&&null==ae[d]&&t(ae,r,f,d,te.BIG_PAWN)}for(h=2;h<4;h++){var d=f+H[n][h];136&d||(null!=ae[d]&&ae[d].color===o?t(ae,r,f,d,te.CAPTURE):d===pe&&t(ae,r,f,pe,te.EP_CAPTURE))}}else for(var h=0,v=J[p.type].length;h<v;h++)for(var m=J[p.type][h],d=f;;){if(d+=m,136&d)break;if(null!=ae[d]){if(ae[d].color===n)break;t(ae,r,f,d,te.CAPTURE);break}if(t(ae,r,f,d,te.NORMAL),"n"===p.type||"k"===p.type)break}}if(!a||s===ce[n]){if(le[n]&te.KSIDE_CASTLE){var b=ce[n],_=b+2;null!=ae[b+1]||null!=ae[_]||g(o,ce[n])||g(o,b+1)||g(o,_)||t(ae,r,ce[n],_,te.KSIDE_CASTLE)}if(le[n]&te.QSIDE_CASTLE){var b=ce[n],_=b-2;null!=ae[b-1]||null!=ae[b-2]||null!=ae[b-3]||g(o,ce[n])||g(o,b-1)||g(o,_)||t(ae,r,ce[n],_,te.QSIDE_CASTLE)}}if(!c)return r;for(var w=[],f=0,v=r.length;f<v;f++)E(r[f]),y(n)||w.push(r[f]),x();return w}function d(e,t){var r="";if(e.flags&te.KSIDE_CASTLE)r="O-O";else if(e.flags&te.QSIDE_CASTLE)r="O-O-O";else{var n=S(e,t);e.piece!==K&&(r+=e.piece.toUpperCase()+n),e.flags&(te.CAPTURE|te.EP_CAPTURE)&&(e.piece===K&&(r+=A(e.from)[0]),r+="x"),r+=A(e.to),e.flags&te.PROMOTION&&(r+="="+e.promotion.toUpperCase())}return E(e),v()&&(r+=m()?"#":"+"),x(),r}function h(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function g(e,t){for(var r=ue.a8;r<=ue.h1;r++)if(136&r)r+=7;else if(null!=ae[r]&&ae[r].color===e){var n=ae[r],o=r-t,i=o+119;if(Z[i]&1<<X[n.type]){if(n.type===K){if(o>0){if(n.color===U)return!0}else if(n.color===N)return!0;continue}if("n"===n.type||"k"===n.type)return!0;for(var u=Y[i],s=r+u,a=!1;s!==t;){if(null!=ae[s]){a=!0;break}s+=u}if(!a)return!0}}return!1}function y(e){return g(C(e),ce[e])}function v(){return y(fe)}function m(){return v()&&0===p().length}function b(){return!v()&&0===p().length}function _(){for(var e={},t=[],r=0,n=0,o=ue.a8;o<=ue.h1;o++)if(n=(n+1)%2,136&o)o+=7;else{var i=ae[o];i&&(e[i.type]=i.type in e?e[i.type]+1:1,i.type===B&&t.push(n),r++)}if(2===r)return!0;if(3===r&&(1===e[B]||1===e[M]))return!0;if(r===e[B]+2){for(var u=0,s=t.length,o=0;o<s;o++)u+=t[o];if(0===u||u===s)return!0}return!1}function w(){for(var e=[],t={},r=!1;;){var n=x();if(!n)break;e.push(n)}for(;;){var o=i().split(" ").slice(0,4).join(" ");if(t[o]=o in t?t[o]+1:1,t[o]>=3&&(r=!0),!e.length)break;E(e.pop())}return r}function k(e){ge.push({move:e,kings:{b:ce.b,w:ce.w},turn:fe,castling:{b:le.b,w:le.w},ep_square:pe,half_moves:de,move_number:he})}function E(e){var t=fe,r=C(t);if(k(e),ae[e.to]=ae[e.from],ae[e.from]=null,e.flags&te.EP_CAPTURE&&(fe===N?ae[e.to-16]=null:ae[e.to+16]=null),e.flags&te.PROMOTION&&(ae[e.to]={type:e.promotion,color:t}),ae[e.to].type===F){if(ce[ae[e.to].color]=e.to,e.flags&te.KSIDE_CASTLE){var n=e.to-1,o=e.to+1;ae[n]=ae[o],ae[o]=null}else if(e.flags&te.QSIDE_CASTLE){var n=e.to+1,o=e.to-2;ae[n]=ae[o],ae[o]=null}le[t]=""}if(le[t])for(var i=0,u=se[t].length;i<u;i++)if(e.from===se[t][i].square&&le[t]&se[t][i].flag){le[t]^=se[t][i].flag;break}if(le[r])for(var i=0,u=se[r].length;i<u;i++)if(e.to===se[r][i].square&&le[r]&se[r][i].flag){le[r]^=se[r][i].flag;break}pe=e.flags&te.BIG_PAWN?"b"===fe?e.to-16:e.to+16:G,e.piece===K?de=0:e.flags&(te.CAPTURE|te.EP_CAPTURE)?de=0:de++,fe===N&&he++,fe=C(fe)}function x(){var e=ge.pop();if(null==e)return null;var t=e.move;ce=e.kings,fe=e.turn,le=e.castling,pe=e.ep_square,de=e.half_moves,he=e.move_number;var r=fe,n=C(fe);if(ae[t.from]=ae[t.to],ae[t.from].type=t.piece,ae[t.to]=null,t.flags&te.CAPTURE)ae[t.to]={type:t.captured,color:n};else if(t.flags&te.EP_CAPTURE){var o;o=r===N?t.to-16:t.to+16,ae[o]={type:K,color:n}}if(t.flags&(te.KSIDE_CASTLE|te.QSIDE_CASTLE)){var i,u;t.flags&te.KSIDE_CASTLE?(i=t.to+1,u=t.to-1):t.flags&te.QSIDE_CASTLE&&(i=t.to-2,u=t.to+1),ae[i]=ae[u],ae[u]=null}return t}function S(e,t){for(var r=p({legal:!t}),n=e.from,o=e.to,i=e.piece,u=0,s=0,a=0,c=0,f=r.length;c<f;c++){var l=r[c].from,d=r[c].to,h=r[c].piece;i===h&&n!==l&&o===d&&(u++,T(n)===T(l)&&s++,j(n)===j(l)&&a++)}return u>0?s>0&&a>0?A(n):a>0?A(n).charAt(1):A(n).charAt(0):""}function I(){for(var e="   +------------------------+\n",t=ue.a8;t<=ue.h1;t++){if(0===j(t)&&(e+=" "+"87654321"[T(t)]+" |"),null==ae[t])e+=" . ";else{var r=ae[t].type,n=ae[t].color,o=n===U?r.toUpperCase():r.toLowerCase();e+=" "+o+" "}t+1&136&&(e+="|\n",t+=8)}return e+="   +------------------------+\n",e+="     a  b  c  d  e  f  g  h\n"}function O(e,t){var r=h(e);if(t){var n=r.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);if(n)var o=n[1],i=n[2],u=n[3],s=n[4]}for(var a=p(),c=0,f=a.length;c<f;c++){if(r===h(d(a[c]))||t&&r===h(d(a[c],!0)))return a[c];if(n&&(!o||o.toLowerCase()==a[c].piece)&&ue[i]==a[c].from&&ue[u]==a[c].to&&(!s||s.toLowerCase()==a[c].promotion))return a[c]}return null}function T(e){return e>>4}function j(e){return 15&e}function A(e){var t=j(e),r=T(e);return"abcdefgh".substring(t,t+1)+"87654321".substring(r,r+1)}function C(e){return e===U?N:U}function P(e){return"0123456789".indexOf(e)!==-1}function D(e){var t=q(e);t.san=d(t,!1),t.to=A(t.to),t.from=A(t.from);var r="";for(var n in te)te[n]&t.flags&&(r+=ee[n]);return t.flags=r,t}function q(e){var t=e instanceof Array?[]:{};for(var r in e)"object"==typeof r?t[r]=q(e[r]):t[r]=e[r];return t}function L(e){return e.replace(/^\s+|\s+$/g,"")}function R(e){for(var t=p({legal:!1}),r=0,n=fe,o=0,i=t.length;o<i;o++){if(E(t[o]),!y(n))if(e-1>0){var u=R(e-1);r+=u}else r++;x()}return r}var N="b",U="w",G=-1,K="p",M="n",B="b",V="r",z="q",F="k",Q="pnbrqkPNBRQK",W="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",$=["1-0","0-1","1/2-1/2","*"],H={b:[16,32,17,15],w:[-16,-32,-17,-15]},J={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},Z=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],Y=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],X={p:0,n:1,b:2,r:3,q:4,k:5},ee={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},te={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},re=7,ne=6,oe=1,ie=0,ue={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},se={w:[{square:ue.a1,flag:te.QSIDE_CASTLE},{square:ue.h1,flag:te.KSIDE_CASTLE}],b:[{square:ue.a8,flag:te.QSIDE_CASTLE},{square:ue.h8,flag:te.KSIDE_CASTLE}]},ae=new Array(128),ce={w:G,b:G},fe=U,le={w:0,b:0},pe=G,de=0,he=1,ge=[],ye={};return n("undefined"==typeof e?W:e),{WHITE:U,BLACK:N,PAWN:K,KNIGHT:M,BISHOP:B,ROOK:V,QUEEN:z,KING:F,SQUARES:function(){for(var e=[],t=ue.a8;t<=ue.h1;t++)136&t?t+=7:e.push(A(t));return e}(),FLAGS:ee,load:function(e){return n(e)},reset:function(){return r()},moves:function(e){for(var t=p(e),r=[],n=0,o=t.length;n<o;n++)"undefined"!=typeof e&&"verbose"in e&&e.verbose?r.push(D(t[n])):r.push(d(t[n],!1));return r},in_check:function(){return v()},in_checkmate:function(){return m()},in_stalemate:function(){return b()},in_draw:function(){return de>=100||b()||_()||w()},insufficient_material:function(){return _()},in_threefold_repetition:function(){return w()},game_over:function(){return de>=100||m()||b()||_()||w()},validate_fen:function(e){return o(e)},fen:function(){return i()},pgn:function(e){var t="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\n",r="object"==typeof e&&"number"==typeof e.max_width?e.max_width:0,n=[],o=!1;for(var i in ye)n.push("["+i+' "'+ye[i]+'"]'+t),o=!0;o&&ge.length&&n.push(t);for(var u=[];ge.length>0;)u.push(x());for(var s=[],a="";u.length>0;){var c=u.pop();ge.length||"b"!==c.color?"w"===c.color&&(a.length&&s.push(a),a=he+"."):a=he+". ...",a=a+" "+d(c,!1),E(c)}if(a.length&&s.push(a),"undefined"!=typeof ye.Result&&s.push(ye.Result),0===r)return n.join("")+s.join(" ");for(var f=0,i=0;i<s.length;i++)f+s[i].length>r&&0!==i?(" "===n[n.length-1]&&n.pop(),n.push(t),f=0):0!==i&&(n.push(" "),f++),n.push(s[i]),f+=s[i].length;return n.join("")},load_pgn:function(e,t){function o(e){return e.replace(/\\/g,"\\")}function i(e){for(var t in e)return!0;return!1}function s(e,t){for(var r="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",n={},i=e.split(new RegExp(o(r))),u="",s="",a=0;a<i.length;a++)u=i[a].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),s=i[a].replace(/^\[[A-Za-z]+\s"(.*)"\]$/,"$1"),L(u).length>0&&(n[u]=s);return n}var a="undefined"!=typeof t&&"sloppy"in t&&t.sloppy,c="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",f=new RegExp("^(\\[(.|"+o(c)+")*\\])("+o(c)+")*1.("+o(c)+"|.)*$","g"),l=e.replace(f,"$1");"["!==l[0]&&(l=""),r();var p=s(l,t);for(var d in p)u([d,p[d]]);if("1"===p.SetUp&&!("FEN"in p&&n(p.FEN)))return!1;var h=e.replace(l,"").replace(new RegExp(o(c),"g")," ");h=h.replace(/(\{[^}]+\})+?/g,"");for(var g=/(\([^\(\)]+\))+?/g;g.test(h);)h=h.replace(g,"");h=h.replace(/\d+\.(\.\.)?/g,""),h=h.replace(/\.\.\./g,""),h=h.replace(/\$\d+/g,"");var y=L(h).split(new RegExp(/\s+/));y=y.join(",").replace(/,,+/g,",").split(",");for(var v="",m=0;m<y.length-1;m++){if(v=O(y[m],a),null==v)return!1;E(v)}if(v=y[y.length-1],$.indexOf(v)>-1)i(ye)&&"undefined"==typeof ye.Result&&u(["Result",v]);else{if(v=O(v,a),null==v)return!1;E(v)}return!0},header:function(){return u(arguments)},ascii:function(){return I()},turn:function(){return fe},move:function(e,t){var r="undefined"!=typeof t&&"sloppy"in t&&t.sloppy,n=null;if("string"==typeof e)n=O(e,r);else if("object"==typeof e)for(var o=p(),i=0,u=o.length;i<u;i++)if(!(e.from!==A(o[i].from)||e.to!==A(o[i].to)||"promotion"in o[i]&&e.promotion!==o[i].promotion)){n=o[i];break}if(!n)return null;var s=D(n);return E(n),s},undo:function(){var e=x();return e?D(e):null},clear:function(){return t()},put:function(e,t){return c(e,t)},get:function(e){return a(e)},remove:function(e){return f(e)},perft:function(e){return R(e)},square_color:function(e){if(e in ue){var t=ue[e];return(T(t)+j(t))%2===0?"light":"dark"}return null},history:function(e){for(var t=[],r=[],n=("undefined"!=typeof e&&"verbose"in e&&e.verbose);ge.length>0;)t.push(x());for(;t.length>0;){var o=t.pop();n?r.push(D(o)):r.push(d(o)),E(o)}return r}}};t.Chess=o,n=function(){return o}.call(t,r,t,e),!(void 0!==n&&(e.exports=n))}]);
//# sourceMappingURL=detail.umd-es2015.min.js.map